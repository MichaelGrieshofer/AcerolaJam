[gd_scene load_steps=27 format=3 uid="uid://bnqlw7ldqlw8q"]

[ext_resource type="Script" path="res://Scripts/mech_interaction_area.gd" id="1_a78nb"]
[ext_resource type="Script" path="res://Scripts/StateMachine/finite_state_machine.gd" id="2_81wgb"]
[ext_resource type="Texture2D" uid="uid://criwhfmnncdam" path="res://Textures/Sprites/mech-Sheet.png" id="2_fj7nx"]
[ext_resource type="Texture2D" uid="uid://b2gx0i6dltffx" path="res://Textures/Sprites/arm_cannon.png" id="3_iqik1"]
[ext_resource type="Script" path="res://Scripts/StateMachine/generic/idle.gd" id="3_uxhkv"]
[ext_resource type="Script" path="res://Scripts/shoot.gd" id="4_aiqa0"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Mech/mech_helper.gd" id="5_2vjcb"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Mech/mech_fall.gd" id="6_cddlp"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Mech/mech_walk.gd" id="6_qxk4j"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Mech/hover.gd" id="8_b1o0x"]
[ext_resource type="Script" path="res://addons/phantom_camera/scripts/phantom_camera/phantom_camera_2D.gd" id="9_3er3h"]
[ext_resource type="Script" path="res://addons/phantom_camera/scripts/resources/tween_resource.gd" id="10_mradi"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Mech/mech_jump.gd" id="10_tvxjy"]
[ext_resource type="Script" path="res://Scripts/StateMachine/Mech/dash.gd" id="12_bah7k"]
[ext_resource type="PackedScene" uid="uid://cv3b24v635f6m" path="res://Nodes/Effects/sprite_trail.tscn" id="14_f6ux4"]
[ext_resource type="Script" path="res://Scripts/health_manager.gd" id="16_k2uc4"]
[ext_resource type="PackedScene" uid="uid://c2dtdmn6cr6kk" path="res://Nodes/Objects/checkpoint.tscn" id="17_fexau"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_c5opg"]
size = Vector2(24, 45)

[sub_resource type="Animation" id="Animation_cwqtd"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Arm:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [Vector2(-13, 4)]
}

[sub_resource type="Animation" id="Animation_igkm3"]
resource_name = "boost"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.5),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [2, 3]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Arm:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.5),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [Vector2(-13, 3), Vector2(-13, 3)]
}

[sub_resource type="Animation" id="Animation_t8no2"]
resource_name = "fall"
length = 0.001
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [5]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Arm:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [Vector2(-12, 5)]
}

[sub_resource type="Animation" id="Animation_fwh7n"]
resource_name = "idle"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.5),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [0, 1]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Arm:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.5),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [Vector2(-13, 4), Vector2(-13, 5)]
}

[sub_resource type="Animation" id="Animation_f6jn0"]
resource_name = "jump"
length = 0.001
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [4]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Arm:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [Vector2(-13, 5)]
}

[sub_resource type="Animation" id="Animation_28jxw"]
resource_name = "walk"
length = 0.6
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [6, 7, 8, 9, 10, 11]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Arm:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2(-13, 4), Vector2(-13, 5), Vector2(-13, 4), Vector2(-13, 4), Vector2(-13, 5), Vector2(-13, 4)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_2444x"]
_data = {
"RESET": SubResource("Animation_cwqtd"),
"boost": SubResource("Animation_igkm3"),
"fall": SubResource("Animation_t8no2"),
"idle": SubResource("Animation_fwh7n"),
"jump": SubResource("Animation_f6jn0"),
"walk": SubResource("Animation_28jxw")
}

[sub_resource type="Resource" id="Resource_1bq4u"]
script = ExtResource("10_mradi")
duration = 0.3
transition = 0
ease = 2

[node name="Mech" type="CharacterBody2D"]
collision_layer = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
visible = false
position = Vector2(0, 9.5)
shape = SubResource("RectangleShape2D_c5opg")

[node name="Interaction" type="Area2D" parent="."]
script = ExtResource("1_a78nb")

[node name="CollisionShape2D2" type="CollisionShape2D" parent="Interaction"]
visible = false
position = Vector2(0, 9.5)
shape = SubResource("RectangleShape2D_c5opg")

[node name="MechPlaceholder" type="Sprite2D" parent="."]
texture = ExtResource("2_fj7nx")
hframes = 13

[node name="Arm" type="Node2D" parent="MechPlaceholder"]
unique_name_in_owner = true
position = Vector2(-13, 4)
metadata/_edit_group_ = true

[node name="ArmTopLevel" type="Node2D" parent="MechPlaceholder/Arm"]
unique_name_in_owner = true
top_level = true

[node name="SpriteTrail" parent="MechPlaceholder/Arm/ArmTopLevel" node_paths=PackedStringArray("target", "copy_rotation") instance=ExtResource("14_f6ux4")]
every_x_frames = 3
target = NodePath("../ArmCannon")
copy_rotation = NodePath("..")

[node name="ArmCannon" type="Sprite2D" parent="MechPlaceholder/Arm/ArmTopLevel"]
position = Vector2(3.5, 0)
texture = ExtResource("3_iqik1")

[node name="CannonMouth" type="Node2D" parent="MechPlaceholder/Arm/ArmTopLevel" node_paths=PackedStringArray("copy_angle", "helper")]
position = Vector2(11, 0)
script = ExtResource("4_aiqa0")
copy_angle = NodePath("..")
helper = NodePath("../../../../FiniteStateMachine/MechHelper")

[node name="AnimationPlayer" type="AnimationPlayer" parent="MechPlaceholder"]
libraries = {
"": SubResource("AnimationLibrary_2444x")
}
autoplay = "idle"

[node name="FiniteStateMachine" type="Node" parent="." node_paths=PackedStringArray("state", "actor", "helper")]
script = ExtResource("2_81wgb")
state = NodePath("Idle")
actor = NodePath("..")
helper = NodePath("MechHelper")

[node name="Idle" type="Node" parent="FiniteStateMachine" node_paths=PackedStringArray("anim")]
script = ExtResource("3_uxhkv")
anim = NodePath("../../MechPlaceholder/AnimationPlayer")
animation = "idle"

[node name="Walk" type="Node" parent="FiniteStateMachine" node_paths=PackedStringArray("anim")]
script = ExtResource("6_qxk4j")
acceleration = 0.02
speed = 200.0
anim = NodePath("../../MechPlaceholder/AnimationPlayer")
animation = "walk"

[node name="Fall" type="Node" parent="FiniteStateMachine" node_paths=PackedStringArray("anim")]
script = ExtResource("6_cddlp")
acceleration = 0.01
speed = 200.0
anim = NodePath("../../MechPlaceholder/AnimationPlayer")
animation = "fall"

[node name="Jump" type="Node" parent="FiniteStateMachine" node_paths=PackedStringArray("anim")]
script = ExtResource("10_tvxjy")
acceleration = 0.01
speed = 200.0
anim = NodePath("../../MechPlaceholder/AnimationPlayer")
animation = "jump"

[node name="Hover" type="Node" parent="FiniteStateMachine" node_paths=PackedStringArray("anim")]
script = ExtResource("8_b1o0x")
propulsion = 250.0
max_propulsion = 200.0
acceleration = 0.02
speed = 200.0
anim = NodePath("../../MechPlaceholder/AnimationPlayer")
animation = "boost"

[node name="Dash" type="Node" parent="FiniteStateMachine" node_paths=PackedStringArray("after_image", "after_image2", "anim")]
script = ExtResource("12_bah7k")
after_image = NodePath("../../MechPlaceholder/Arm/ArmTopLevel/SpriteTrail")
after_image2 = NodePath("../../SpriteTrail")
anim = NodePath("../../MechPlaceholder/AnimationPlayer")
animation = "boost"

[node name="MechHelper" type="Node" parent="FiniteStateMachine" node_paths=PackedStringArray("hover_state", "dash_state", "ct", "ib", "body", "idle_state", "walk_state", "fall_state", "jump_state")]
script = ExtResource("5_2vjcb")
hover_state = NodePath("../Hover")
dash_state = NodePath("../Dash")
ct = NodePath("../../CT")
ib = NodePath("../../IB")
body = NodePath("../../MechPlaceholder")
idle_state = NodePath("../Idle")
walk_state = NodePath("../Walk")
fall_state = NodePath("../Fall")
jump_state = NodePath("../Jump")

[node name="CT" type="Timer" parent="."]
wait_time = 0.2
one_shot = true

[node name="IB" type="Timer" parent="."]
wait_time = 0.2
one_shot = true

[node name="PhantomCamera2D" type="Node2D" parent="."]
unique_name_in_owner = true
position = Vector2(0, -30)
script = ExtResource("9_3er3h")
priority_override = false
priority = 0
zoom = Vector2(0.75, 0.75)
follow_mode = 2
follow_target = NodePath("..")
follow_parameters/target_offset = Vector2(0, -30)
follow_parameters/damping = true
follow_parameters/damping_value = 10.0
frame_preview = false
pixel_perfect = false
limit/draw_limits = false
limit/left = -10000000
limit/top = -10000000
limit/right = 10000000
limit/bottom = 10000000
limit/limit_node_target = NodePath("")
limit/smoothed = false
tween_parameters = SubResource("Resource_1bq4u")
tween_on_load = true
inactive_update_mode = 0

[node name="SpriteTrail" parent="." node_paths=PackedStringArray("target") instance=ExtResource("14_f6ux4")]
every_x_frames = 3
target = NodePath("../MechPlaceholder")

[node name="HealthManager" type="Node" parent="."]
script = ExtResource("16_k2uc4")

[node name="Checkpoint" parent="." instance=ExtResource("17_fexau")]
visible = false
position = Vector2(0, 16)
update_position = true

[node name="Water" type="Node" parent="."]
unique_name_in_owner = true
script = ExtResource("16_k2uc4")
max_health = 50.0

[node name="WaterPunishmentTimer" type="Timer" parent="."]
unique_name_in_owner = true
wait_time = 2.0
one_shot = true

[connection signal="health_depleted" from="Water" to="FiniteStateMachine/Hover" method="_on_water_health_depleted"]
[connection signal="health_depleted" from="Water" to="FiniteStateMachine/MechHelper" method="_on_water_health_depleted"]
[connection signal="health_modified" from="Water" to="FiniteStateMachine/MechHelper" method="_on_water_health_modified"]
[connection signal="timeout" from="WaterPunishmentTimer" to="FiniteStateMachine/MechHelper" method="_on_water_punishment_timer_timeout"]
